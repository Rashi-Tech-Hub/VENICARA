<!DOCTYPE html>
<html lang="en">
 <head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>VENICARA</title>
  <link
   href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css"
   rel="stylesheet"
   integrity="sha384-LN+7fdVzj6u52u30Kp6M/trliBMCMKTyK833zpbD+pXdCLuTusPj697FH4R/5mcr"
   crossorigin="anonymous"
  />
  <script
  defer
   src="https://kit.fontawesome.com/f45c5ea548.js"
   crossorigin="anonymous"
  ></script>
  <link rel="stylesheet" href="/css/userAuth.css" />
  <link rel="stylesheet" href="/css/userHeader.css" />
 </head>
 <body class="d-flex flex-column w-100">
  <header class="p-md-4 pt-4 pb-4 w-100 shadow sticky-top position-relative">
   <div class="container-fluid">
    <div class="row">
     <div class="col-4 position-relative">
      <img class="logo img-fluid" src="/images/logo.avif" alt="" />
     </div>
     <div class="col-4 d-flex justify-content-center align-items-center">
      <a href="/home" class="text-decoration-none text-black"
       ><p class="d-inline mb-0 fw-semibold fs-md-4">HOME</p></a
      >
      <a href="/shop" class="text-decoration-none text-black"
       ><p class="d-inline ms-md-4 ms-2 mb-0 fw-semibold fs-md-4">SHOP</p></a
      >
     </div>
     <div class="col-4 d-flex justify-content-end align-items-center">
      <form
       class="searchForm position-relative d-md-inline-block d-none"
       id="search-form"
      >
       <input
        type="text"
        name="search"
        id="inputSearch"
        style="border-color: rgb(113, 89, 3) !important"
        class="form-control rounded-5 pe-5"
        placeholder="Search..."
       />
       <button
        type="submit"
        id="cancel"
        style="
         background: linear-gradient(to bottom,rgb(93, 88, 21),rgb(227, 195, 8));
         border: none;
         padding: 0.6rem 0.8rem;
         right: 0.2rem;
        "
        class="btn border-0 btn-secondary rounded-5 position-absolute top-50 translate-middle-y"
       >
        <i class="fs-5 text-white fa-solid fa-magnifying-glass"></i>
       </button>
       <div id="searchResults" class="position-absolute d-none rounded-4" style="top:5rem;right:-4rem;left:-4rem;height:50vh;overflow-y: scroll;overflow-x: hidden;scrollbar-width: 2px;">
        
       </div>
      </form>
      <a href="/whishlist"
       ><i class="fs-4 text-black fa-regular fa-heart ms-3"></i
      ></a>
      <a href="/cart"
       ><i class="fa-solid fa-cart-shopping ms-3 fs-4 text-black"></i></a>
      <a href="/profile"
       ><i class="fs-4 text-black fa-regular fa-circle-user ms-3"></i
      ></a>
     </div>
    </div>
    <div id="successBox" class="successBox w-100 d-flex justify-content-center">
     <%if(messages.success.length>0){%>
     <div class="alert alert-success text-center w-md-25 w-75">
      <%=messages.success[0]%>
     </div>
     <%}%>
    </div>
    <div id="errorBox" class="errorBox w-100 d-flex justify-content-center">
     <%if(messages.error.length>0){%>
     <div class="alert alert-danger text-center w-md-25 w-75">
      <%=messages.error[0]%>
     </div>
     <%}%>
    </div>
  </div>
</header>
<script>
  const searchInput=document.getElementById('inputSearch')
  const resultBox=document.getElementById('searchResults')
  const cancel=document.getElementById('cancel')
    document.addEventListener("click", (e) => {
  if (!searchInput.contains(e.target) && !resultBox.contains(e.target)) {
    resultBox.classList.add('d-none')
    searchInput.value = "";   // clear input
    resultBox.innerHTML = ""; // clear results
    cancel.innerHTML='<i class="fs-5 text-white fa-solid fa-magnifying-glass"></i>'
  }else if(searchInput.contains(e.target)){
    searchBox.classList.remove('d-none')
  }
});

    const searchForm = document.getElementById("search-form");
    searchForm.addEventListener("input", (e) => {
      const query = searchForm.search.value.trim();
      if (!query) return; // donâ€™t call API on empty input
      resultBox.classList.remove('d-none')
      const input=document.getElementById('inputSearch')
      if(searchForm.value!="") cancel.innerHTML='<i class="fa-solid fa-xmark"></i>'
    fetch(`/search?search=${encodeURIComponent(query)}`, {
     method: "GET",
    })
     .then((res) => res.json())
     .then((data) => {
      const searchResults = document.getElementById("searchResults");
      searchResults.innerHTML = "";
      data.products.forEach((product) => {
       const a = document.createElement("a");
       a.href = `/products/${product._id}`;
        a.classList.add("text-decoration-none", "text-white", 'd-block', 'mb-2', 'bg-secondary','rounded-4');
       a.innerHTML = `
       <div class="searchResults row p-2 text-white rounded-4">
          <span class="col-md-3"><img src="${product.images[0]}" alt="" class="img-fluid rounded-4"></span>
          <span class="col-md-9 d-flex align-items-center">${product.name}</span>
        </div>
        `;
       searchResults.appendChild(a);
      });
     })
     .catch((err) => console.log(err));
   });
  </script>
